@page "/editeur/utilisateurs"
@layout EditorLayout

<div>
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Prénom</th>
                <th scope="col">Nom</th>
                <th scope="col">Pseudo</th>
                <th scope="col">Admin</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (Users is null)
            {
                <tr>
                    <td colspan=3 class="text-center">
                        <div class="spinner-border" role="status" />
                    </td>
                </tr>
            }
            else if (!Users.Any())
            {
                <tr class="p-2">
                    <td colspan=3 class="text-center">Aucune course</td>
                </tr>
            }
            else
            {
                @foreach (var user in Users)
                {
                    <tr @key="@user">
                        <td>@user.FirstName</td>
                        <td>@user.LastName</td>
                        <td>@user.UserName</td>
                        <td><span class="fa fas-@(user.IsAdmin? "check text-success":"xmark text-danger")"></span></td>
                        <td>
                            <button class="btn btn-secondary btn-sm" @onclick="() => ConfirmEditUser(user)"><span class="fas fa-pencil"></span></button>
                            <button class="btn btn-warning btn-sm" @onclick="() => ConfirmChangePassword(user.Id)"><span class="fas fa-key"></span></button>
                            <button class="btn btn-danger btn-sm" @onclick="() => ConfirmDeleteUser(user)"><span class="fas fa-trash"></span></button>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<h1>Editer les utilisateurs</h1>
<div class="d-flex flex-row">
    <EditForm Model="@AddUserModel" OnValidSubmit="@AddUser">
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@AddUserModel.FirstName" placeholder="Prénom" required>
        </div>
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@AddUserModel.LastName" placeholder="Nom" required>
        </div>
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@AddUserModel.UserName" placeholder="Pseudo" required>
        </div>
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-key"></span>
            <input type="password" class="form-control" @bind-value="@AddUserModel.Password" placeholder="Mot de passe">
        </div>
        <div class="p-2">
            <button class="btn btn-primary" type="submit">Créer</button>
        </div>
    </EditForm>
</div>

<ConfirmDialog @ref="DeleteDialog"
               Title="Supprimer l'utilisateur"
               ConfirmationChanged="(confirm) => DeleteUser(confirm)" />
<EditDialog @ref="EditDialog"
            Title="Editer l'utilisateur"
            ConfirmationChanged="(confirm) => UpdateUser(confirm)">
    <div class="d-flex flex-row">
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@UpdateUserModel.FirstName" placeholder="Prénom" required>
        </div>
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@UpdateUserModel.LastName" placeholder="Nom" required>
        </div>
        <div class="input-group p-2 col-12 col-md-6">
            <span class="input-group-text fas fa-user"></span>
            <input type="text" class="form-control" @bind-value="@UpdateUserModel.UserName" placeholder="Pseudo" required>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" @bind-value="@UpdateUserModel.IsAdmin" id="isAdminCheckBox" checked="@UpdateUserModel.IsAdmin">
            <label class="form-check-label" for="isAdminCheckBox">Administrateur</label>
        </div>
    </div>
</EditDialog>

<EditDialog @ref="EditPasswordDialog"
            Title="Modifier le mot de passe"
            ConfirmationChanged="(confirm) => ChangeUserPassword(confirm)">
    <div class="p-2">
        <label for="race-name" class="form-label">Mot de passe</label>
        <input id="race-name" class="form-control" type="password" @bind-value="@NewPassword" placeholder="Password" />
    </div>
</EditDialog>

